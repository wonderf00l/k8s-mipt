### **Домашнее задание 3: Добавление мониторинга через Prometheus**

#### **1. Настроить Prometheus для сбора метрик**

* Разверните Prometheus либо вручную, либо через официальный Helm-чарт `prometheus-community/kube-prometheus-stack`.
* Убедитесь, что Prometheus может:

  * собирать метрики с подов, содержащих **Envoy proxy** (через Istio)
  * автоматически обнаруживать сервисы внутри кластера через `kubernetes_sd_configs`
* Проверьте, что метрики Istio (например, `istio_requests_total`, `istio_request_duration_seconds`) доступны в интерфейсе Prometheus.

#### **2. Добавить метрики в пользовательское приложение**

* Модифицируйте приложение так, чтобы оно экспортировало метрики в формате Prometheus (например, через `/metrics`). Метрики должны включать:
  * общее количество вызовов `/log`
  * успешные и неуспешные попытки логирования
  * среднее время обработки запроса
* Используйте библиотеку для метрик на выбранном языке .

#### **3. Обеспечить сбор метрик Prometheus из приложения**

* Настройте `ServiceMonitor` или `PodMonitor`, если используется kube-prometheus-stack.
  Альтернативно — добавьте `scrape_configs` вручную, если вы используете свой Prometheus.
* Проверьте, что Prometheus может собирать метрики из `/metrics` endpoint-а приложения.
* Настройте label-селекторы для обнаружения только нужных подов.

### **Ожидаемый результат**

* Скрипт `deploy.sh` автоматически разворачивает все необходимое